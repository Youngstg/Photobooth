<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Template Previews</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: #A8D5BA;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
        }
        h1 {
            text-align: center;
            color: #2C2416;
        }
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        button {
            padding: 15px 30px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            background: #7BC4A8;
            color: #2C2416;
            border: 3px solid #2C2416;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #A8D5BA;
        }
        #status {
            margin: 20px 0;
            padding: 15px;
            background: #F5E6D3;
            border: 2px solid #2C2416;
            border-radius: 4px;
            font-size: 14px;
        }
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .preview-item {
            border: 3px solid #2C2416;
            padding: 10px;
            background: #EDD9C3;
            border-radius: 4px;
        }
        .preview-item img {
            width: 100%;
            height: auto;
            border: 2px solid #2C2416;
        }
        .preview-item .label {
            text-align: center;
            font-weight: bold;
            margin-top: 8px;
            font-size: 12px;
        }
        canvas {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Template Frame Generator</h1>
        <div class="controls">
            <button onclick="generateAllTemplates()">Generate All Templates</button>
            <button onclick="downloadAllAsZip()" id="downloadBtn" style="display:none;">Download All as ZIP</button>
        </div>
        <div id="status">Klik tombol untuk mulai generate template...</div>
        <div id="preview-grid" class="preview-grid"></div>
    </div>

    <canvas id="tempCanvas"></canvas>

    <script src="app.js"></script>
    <script>
        const generatedImages = [];

        // Create dummy photos for preview
        function createDummyPhoto(index) {
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 600;
            const ctx = canvas.getContext('2d');

            // Gradient background
            const gradient = ctx.createLinearGradient(0, 0, 800, 600);
            gradient.addColorStop(0, '#7BC4A8');
            gradient.addColorStop(0.5, '#A8D5BA');
            gradient.addColorStop(1, '#EDD9C3');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 800, 600);

            // Add text
            ctx.fillStyle = '#2C2416';
            ctx.font = 'bold 48px Courier New';
            ctx.textAlign = 'center';
            ctx.fillText(`Photo ${index + 1}`, 400, 300);

            const img = new Image();
            img.src = canvas.toDataURL();
            return img;
        }

        async function generateAllTemplates() {
            const statusDiv = document.getElementById('status');
            const previewGrid = document.getElementById('preview-grid');
            previewGrid.innerHTML = '';
            generatedImages.length = 0;

            statusDiv.innerHTML = 'Loading assets...';

            // Wait for assets to load first
            try {
                await loadAssets();
                statusDiv.innerHTML = 'Assets loaded! Generating templates...';
            } catch (error) {
                console.error('Error loading assets:', error);
                statusDiv.innerHTML = 'Warning: Some assets failed to load. Continuing with generation...';
            }

            const allThemes = [
                { id: 'spotify-player', name: 'Spotify Player' },
                { id: 'laptop-ui', name: 'Laptop Interface' },
                { id: 'polaroid', name: 'Polaroid Classic' },
                { id: 'phone-chat', name: 'Phone Chat' },
                { id: 'split-screen', name: 'Split Screen' },
                { id: 'filmstrip', name: 'Film Strip' },
                { id: 'instagram-grid', name: 'Instagram Grid' },
                { id: 'polaroid-stack', name: 'Polaroid Stack' },
                { id: 'comic-strip', name: 'Comic Strip' },
                { id: 'photo-grid', name: 'Photo Grid' },
                { id: 'video-call', name: 'Video Call UI' },
                { id: 'magazine', name: 'Magazine Layout' }
            ];

            let count = 0;
            const total = 12 * 4; // 12 themes × 4 photo counts

            for (let photoCount = 1; photoCount <= 4; photoCount++) {
                // Create dummy photos
                const dummyPhotos = [];
                for (let i = 0; i < photoCount; i++) {
                    dummyPhotos.push(createDummyPhoto(i));
                }

                // Wait for images to load
                await Promise.all(dummyPhotos.map(img => {
                    return new Promise(resolve => {
                        if (img.complete) resolve();
                        else img.onload = resolve;
                    });
                }));

                for (const theme of allThemes) {
                    const canvas = document.getElementById('tempCanvas');
                    const ctx = canvas.getContext('2d');

                    // Get frame config
                    const frameConfig = frameTemplates[photoCount].find(f => f.themeId === theme.id);
                    if (!frameConfig) continue;

                    canvas.width = frameConfig.width;
                    canvas.height = frameConfig.height;

                    // Render frame
                    frameConfig.render(ctx, dummyPhotos);

                    // Convert to image
                    const dataUrl = canvas.toDataURL('image/png');
                    const filename = `${theme.id}_${photoCount}photo.png`;

                    // Store for download
                    generatedImages.push({
                        filename: filename,
                        dataUrl: dataUrl,
                        themeName: theme.name,
                        photoCount: photoCount
                    });

                    // Add preview
                    const previewItem = document.createElement('div');
                    previewItem.className = 'preview-item';
                    previewItem.innerHTML = `
                        <img src="${dataUrl}" alt="${filename}">
                        <div class="label">${theme.name} (${photoCount} foto)</div>
                    `;
                    previewGrid.appendChild(previewItem);

                    count++;
                    statusDiv.innerHTML = `Generated ${count}/${total} templates...`;

                    // Small delay to prevent browser freeze
                    await new Promise(resolve => setTimeout(resolve, 10));
                }
            }

            statusDiv.innerHTML = `✓ Successfully generated ${count} templates! Click "Download All as ZIP" to save.`;
            document.getElementById('downloadBtn').style.display = 'inline-block';
        }

        async function downloadAllAsZip() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = 'Preparing download... Creating individual files...';

            // Since we can't create actual ZIP in browser without library,
            // we'll download them one by one
            for (let i = 0; i < generatedImages.length; i++) {
                const img = generatedImages[i];
                const link = document.createElement('a');
                link.download = img.filename;
                link.href = img.dataUrl;
                link.click();

                statusDiv.innerHTML = `Downloading ${i + 1}/${generatedImages.length}: ${img.filename}`;

                // Delay between downloads to prevent browser blocking
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            statusDiv.innerHTML = `✓ All ${generatedImages.length} templates downloaded to your Downloads folder!<br>Please check your Downloads and move them to 'd:\\Download\\Photobooth\\template' folder.`;
        }

        // Auto-generate on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                generateAllTemplates();
            }, 500);
        });
    </script>
</body>
</html>
